{% load static %}
<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Tasks - TaskFlow</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet" />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
        <link rel="stylesheet" href="{% static 'css/style.css'%}" />
    </head>
    <body>
        <div
            class="d-md-none p-3 bg-white border-bottom d-flex justify-content-between align-items-center fixed-top">
            <div class="d-flex align-items-center gap-1">
                <img
                    src="{% static 'image/Tasklogo.png' %}"
                    alt="Logo"
                    style="width: 35px; object-fit: contain" />
                <h1 class="h3 fw-bold m-0 brand-name">TaskFlow</h1>
            </div>
            <button
                class="btn btn-light"
                type="button"
                data-bs-toggle="offcanvas"
                data-bs-target="#sidebarMenu">
                <i class="fa-solid fa-bars"></i>
            </button>
        </div>

        <aside
            class="sidebar offcanvas-md offcanvas-start d-flex flex-column py-4"
            tabindex="-1"
            id="sidebarMenu">
            <div class="px-4 mb-4">
                <div class="d-flex align-items-center gap-1 mb-2">
                    <img
                        src="{% static 'image/Tasklogo.png' %}"
                        alt="Logo"
                        style="width: 40px; object-fit: contain" />
                    <h1 class="h3 fw-bold m-0 brand-name">TaskFlow</h1>
                </div>
                <div class="d-flex align-items-center text-muted small">
                    <i class="fa-solid fa-graduation-cap me-2"></i>
                    <span>Student</span>
                </div>
                <div class="small text-secondary fw-bold">Demo User</div>
            </div>
            <nav class="nav flex-column px-3 flex-grow-1">
                <a href="{% url 'dashboard'%}" class="nav-link"
                    ><i class="fa-solid fa-grip-vertical me-2 w-25px"></i>
                    Dashboard</a
                >
                <a href="{% url 'tasks'%}" class="nav-link active"
                    ><i class="fa-solid fa-list-check me-2 w-25px"></i> Tasks</a
                >
                <a href="analytics.html" class="nav-link"
                    ><i class="fa-solid fa-chart-line me-2 w-25px"></i>
                    Analytics</a
                >
                <a href="settings.html" class="nav-link"
                    ><i class="fa-solid fa-gear me-2 w-25px"></i> Settings</a
                >
            </nav>
            <div class="px-3 mt-auto">
                <a href="index.html" class="logout-link"
                    ><i class="fa-solid fa-arrow-right-from-bracket me-2"></i>
                    Logout</a
                >
            </div>
        </aside>

        <main class="content-area pt-5 pt-md-4">
            <header
                class="d-flex justify-content-between align-items-start mb-4">
                <div>
                    <h2 class="h3 fw-bold">My Tasks</h2>
                    <p class="text-muted small m-0">{% now "l, F j, Y" %}</p>
                </div>
                <button
                    class="btn bg-primary-custom btn-sm rounded pt-2 pb-2"
                    data-bs-toggle="modal"
                    data-bs-target="#taskModal">
                    <i class="fa-solid fa-plus me-1"></i> New Task
                </button>
            </header>

            <div class="row g-2 mb-4">
                <div class="col-md-6">
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0"
                            ><i
                                class="fa-solid fa-magnifying-glass text-muted"></i
                        ></span>
                        <input
                            type="text"
                            class="form-control border-start-0"
                            placeholder="Search tasks..." />
                    </div>
                </div>
                <div class="col-md-3">
                    <select class="form-select">
                        <option>All Categories</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select">
                        <option>All Subjects</option>
                    </select>
                </div>
            </div>

            <div
                class="btn-group w-100 mb-4 bg-light p-1 rounded-3"
                role="group">
                <button
                    type="button"
                    class="btn btn-light shadow-sm text-dark fw-bold">
                    Pending (1)
                </button>
                <button
                    type="button"
                    class="btn btn-link text-decoration-none text-muted">
                    In Progress (1)
                </button>
                <button
                    type="button"
                    class="btn btn-link text-decoration-none text-muted">
                    Completed (1)
                </button>
            </div>
            {% for task in tasks %}
            <div class="tasks-list">
                <div
                    class="task-card p-3 mb-3 {% if task.priority == 'High' %}border-danger{% endif %}">
                    <div
                        class="d-flex justify-content-between align-items-start mb-2">
                        <div class="d-flex align-items-center gap-2">
                            {% if task.priority == "High" %}
                            <h3 class="h6 fw-bold m-0" style="color: #dc3545">
                                {{ task.task }}
                            </h3>
                            <i
                                class="fa-solid fa-circle-exclamation text-danger me-1"
                                title="High Priority"></i>
                            {% elif task.priority == "Medium" %}
                            <h3 class="h6 fw-bold m-0" style="color: #fd7d14">
                                {{ task.task }}
                            </h3>
                            {% else %}
                            <h3 class="h6 fw-bold m-0" style="color: #198754">
                                {{ task.task }}
                            </h3>
                            {% endif %}
                        </div>

                        <div class="d-flex gap-1">
                            <button class="btn btn-light btn-sm">
                                <i class="fa-regular fa-circle-play"></i>
                            </button>
                            <button class="btn btn-light btn-sm">
                                <i class="fa-solid fa-ellipsis-vertical"></i>
                            </button>
                        </div>
                    </div>

                    <div class="d-flex gap-4 text-muted small mb-3">
                        <span
                            ><i class="fa-regular fa-clock me-1"></i> {{ task.duration|default:"30" }} min</span
                        >
                        <span
                            ><i class="fa-regular fa-calendar me-1"></i> 
                            {{ task.deadline|date:"M d, Y" }}</span
                        >
                    </div>

                    <div class="d-flex gap-2">
                        {% if task.priority == 'High' %}
                        <span
                            class="tag"
                            style="background-color: #f8d7da; color: #dc3545">
                            {{ task.priority }}
                        </span>
                        {% elif task.priority == 'Medium' %}
                        <span
                            class="tag"
                            style="background-color: #fff3cd; color: #856404">
                            {{ task.priority }}
                        </span>
                        {% else %}
                        <span
                            class="tag"
                            style="background-color: #d1e7dd; color: #0f5132">
                            {{ task.priority }}
                        </span>
                        {% endif %}
                        <span class="tag pending">pending</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </main>

        <div class="modal fade" id="taskModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header border-0 pb-0">
                        <div>
                            <h5 class="modal-title fw-bold">Create New Task</h5>
                            <p class="text-muted small m-0">
                                Add a new task to your workflow
                            </p>
                        </div>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form action="{% url 'addtask' %} " method="POST">
                            {% csrf_token %}
                            <div class="mb-3">
                                <label class="form-label fw-bold small"
                                    >Task Name
                                    <span class="text-danger">*</span></label
                                >
                                <input
                                    type="text"
                                    name="task"
                                    class="form-control bg-light border-0"
                                    required />
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold small"
                                    >Description</label
                                >
                                <textarea
                                    class="form-control bg-light border-0"
                                    rows="3"></textarea>
                            </div>
                            <div class="row mb-3">
                                <!-- <div class="col-6">
                                    <label class="form-label fw-bold small"
                                        >Category</label
                                    >
                                    <select
                                        class="form-select bg-light border-0">
                                        <option>Assignment</option>
                                    </select>
                                </div> -->
                                <div class="col-6">
                                    <label class="form-label fw-bold small"
                                        >Priority</label
                                    >
                                    <select
                                        name="priority"
                                        class="form-select bg-light border-0">
                                        <option>High</option>
                                        <option>Medium</option>
                                        <option>Low</option>
                                    </select>
                                </div>
                                <div class="col-6">
                                    <label class="form-label fw-bold small"
                                        >Deadline</label
                                    >
                                    <input
                                        type="date"
                                        name="deadline"
                                        class="form-control bg-light border-0"
                                        required />
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold small"
                                    >Duration (min)</label
                                >
                                <input
                                    type="number"
                                    name="duration"
                                    class="form-control bg-light border-0"
                                    value="30"
                                    required />
                            </div>
                            <div class="form-check form-switch mb-4">
                                <input
                                    class="form-check-input"
                                    type="checkbox"
                                    role="switch" />
                                <label
                                    class="form-check-label fw-bold small ms-2"
                                    >Hard Deadline (Cannot be moved)</label
                                >
                            </div>
                            <div class="d-flex justify-content-end gap-2">
                                <button
                                    type="button"
                                    class="btn btn-light text-muted fw-bold"
                                    data-bs-dismiss="modal">
                                    Cancel
                                </button>
                                <button
                                    type="submit"
                                    class="btn bg-primary-custom fw-bold">
                                    Create Task
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // Target your specific modal
                const taskModal = document.getElementById("taskModal");

                // Listen for Bootstrap's 'hidden' event (when the modal completely closes)
                taskModal.addEventListener("hidden.bs.modal", function () {
                    // Find the form inside the modal and trigger a reset
                    const form = taskModal.querySelector("form");
                    if (form) {
                        form.reset();
                    }
                });
            });
        </script>
    </body>
</html>
